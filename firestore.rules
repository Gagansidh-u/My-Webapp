
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Default deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }

    // Rules for the 'orders' collection
    match /orders/{orderId} {
      // ANY authenticated user can perform admin actions (list, read, update).
      // This is required for the admin panel to function, as the admin is just a standard authenticated user.
      allow list, read, update: if request.auth != null;
      
      // ANY authenticated user can CREATE an order.
      allow create: if request.auth != null;
      
      // A specific user can GET their OWN order document (for the 'My Orders' page).
      // This rule is more specific than the general 'read' above, so it is respected.
      allow get: if request.auth != null && request.auth.uid == resource.data.userId;
    }

    // Rules for the 'contacts' collection
    match /contacts/{contactId} {
        // ANYONE can create a contact message (for the contact form).
        allow create: if true;

        // ANY authenticated user can manage contacts.
        // Required for the admin panel.
        allow read, list, update, delete: if request.auth != null;
    }
  }
}
