
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if the user is an admin
    function isAdmin() {
      return request.auth.token.email == "helpdesk.grock@outlook.com";
    }

    // Rules for the 'orders' collection
    match /orders/{orderId} {
      // Admins can read, write, create, and delete any order
      allow read, write, create, delete: if isAdmin();
      
      // Logged-in users can read and create their own orders
      allow read, create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      
      // Users cannot update or delete their orders directly
      allow update, delete: if false;
    }

    // Rules for the 'contacts' collection
    match /contacts/{contactId} {
        // Admins can read, write, create, and delete any contact message
        allow read, write, create, delete: if isAdmin();

        // Any user (logged in or not) can create a contact message
        allow create: if true;

        // Logged-in users can read and delete their own messages
        allow read, delete: if request.auth != null && request.auth.uid == resource.data.userId;

        // Users cannot update their messages
        allow update: if false;
    }
  }
}
