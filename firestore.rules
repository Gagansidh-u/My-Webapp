rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Default deny all access to prevent unsecured collections
    match /{document=**} {
      allow read, write: if false;
    }

    // Rules for the 'orders' collection
    match /orders/{orderId} {
      // Allow a user to create an order if they are logged in.
      allow create: if request.auth != null;
      
      // Allow a user to read an order if they are the owner.
      // Allow any logged-in user (acting as admin) to read or update any order.
      allow read, update: if request.auth != null && (request.auth.uid == resource.data.userId || exists(/databases/$(database)/documents/admins/$(request.auth.uid)));
    }

    // Rules for the 'contacts' collection
    match /contacts/{contactId} {
      // Allow anyone to create a contact message.
      allow create: if true;

      // Allow any logged-in user (acting as admin) to read or update contact messages.
      allow read, update: if request.auth != null && exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }

    // Rules for the 'admins' collection
    match /admins/{userId} {
      // Only admins can read the admin list.
      allow get, list: if request.auth != null && exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
  }
}
